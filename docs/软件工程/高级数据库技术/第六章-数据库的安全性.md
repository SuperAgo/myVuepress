---
title: 第六章 数据库的安全性
tags:
  - 高级数据库技术
categories:
  - 复习
date: 2020-08-12 11:43:00
---
## 安全性概述
安全性  
- 计算机系统的安全性是指为计算机系统建立和采取各种安全保护措施，以保护计算机系统中的硬件、软件及数据;防止因偶然或恶意的原因使系统遭到破坏，数据遭到更改或泄露
- 数据库的安全性是指保护数据库，防止因用户非法使用数据库造成数据泄露、更改或破坏

数据库安全性保护分层  
- 物理层
- 人际层
- 网络层 
- 数据库系统层
- 操作系统层
- 注意：物理层、人际层、操作系统层和网络层等虽然很重要，但不在我们所要讨论的范围。我们主要从数据库用户的角度，讨论DBMS提供的数据库安全性保护措施

恶意访问的形式可能存在  
- 未经授权读取数据
- 未经授权修改数据
- 未经授权删除数据

数据库安全保护的任务  
- 防止对数据的未经过授权的存取，确保敏感信息没有被不“需要知道”这些信息的人访问得到;
- 防止未经过授权的人员删除和修改数据;
- 监视对数据的访问和更改等使用情况

安全性保护手段  
- 用户标识与鉴别
- 存取控制
- 视图
- 审计和加密
## 用户标识与鉴别
用户标识与鉴别  
- 用户标识与鉴别是系统提供的最外层安全保护指施
- 其基本方法是：系统提供一定的方式让用户标识自己的名字或身份；系统内部记录着所有合法用户的标识;每次用户要求进入系统（与数据库连接）时，由系统核对用户提供的身份标识；通过鉴别的合法用户才能进入系统，建立数据库连接

更新方式的用户标识与鉴别  
- 使用动态产生的新口令登录数据库管理系统，比如短信密码或者动态令牌方式
- 利用只有用户具有的物品鉴别用户：可以使用磁卡、IC卡等作为用户身份的凭证，但必须有相应的读卡设备
  - 例如，银行广泛使用磁卡-密码鉴别储户身份，允许合法的储户访问他/她的储蓄信息
- 利用用户的个人特征鉴别用户：指纹、视网膜、声波、人脸等都是用户个人特征
## 自主存取控制
### 数据对象和存取权
#### 存取控制的对象
- 数据库
- 关系（表或视图）
- 属性（列）或元组
- 数据库模式
#### 存取权限
允许的操作  
- 数据对象上允许的操作有：`SELECT|INSERT|UPDATE|DELETE`
- 数据库模式可以是模式、基本表、视图和索引，用户可以获得的授权可以是：`RESOURCE|CREATE VIEW|ALTER|DROP`
### 存取控制的任务
允许的操作  
- 授权
  - 在DDL中提供相应的授权语句，允许用户自主的定义存取权限，并将用户的授权登记在数据字典中
- 合法权限检查
  - 当用户发出存取数据库的操作请求后，DBMS将查找数据字典，根据用户权限进行合法权检查；如果用户的操作请求超出了定义的权限，则系统将拒绝执行此操作
### 权限的授予和回收
####权限授予
授权语句GRANT，语句格式如下：  
```
GRANT<权限列表>ON<对象名>TO<用户/角色列表>
[WITH GRANT OPTION]
```
- 将一种或多种存取权限赋予一个或多个用户或角色
- 包含可选短语WITH GRANT OPTION时，获得授权的用户还可以把他/她获得权限授予其他用户；缺省时，获得权限的用户不能传播权限

#### 回收授权
收回授权使用REVOKE语句，其语句的常用形式如下：  
REVOKE<权限列表>ON<对象名>FROM<用户/角色列表>{CASCADE|RESTRICT}
### 角色
- SQL-99支持角色
- 使用角色进行授权必须先创建角色，将数据库对象上的存取授权授予角色，才能将角色授予用户，使得用户拥有角色所具有的所有存取权限
- SQL-99允许收回赋予角色的存取权，收回授予用户的角色

#### 创建角色和角色授权
`CREATE ROLE <角色名>`  
- 该语句创建一个角色，用<角色名>命名
- 可以像对用户授权那样，使用授权语句对角色进行授权

#### 使用角色授权
- 使用如下语句将一个或多个角色授予一个或多个用户/角色；  
```
GRANT<角色列表> TO <用户/角色列表>
[WITH ADMIN OPTION]
```
  - 其中<角色列表>是一个或多个角色名，中间用逗号隔开；
  - <用户/角色列表>是一个或多个用户名或角色名，中间用逗号隔开。
  - 获得角色授权的用户或角色具有<角色列表>中角色所具有的存权限。
  - 可选短语WTTH ADMIN OPTION允许获得角色授权的用户可以传播角色授权；缺省时不能传播
- 例:
`CREATE ROLE Manager;创建一个名为Manager的角色`
  - 语句`GRANT Teller TO LiMing, ZhangHua, Manager`
  - 将角色Teller授予用户LiMing、ZhangHua和角色Manager。这样，他们就具有关系Account, Loan, Depositor和Borrower上的所有存取权
  - 语句`GRANT ALL PRIVILIGES ON Branch TO Manager`
  - 将关系Branch上的所有权限授予角色Manager
  - 若WangWanli是经理，可使用如下语句将角色Manager授予WangWanli，并允许他将Manager角色转授予其他人：  `GRANT Manager TO WangWanli WITH ADMIN OPTION;`
#### 收回角色的权限
- 像从用户回收授权一样，使用REVOKE语句回收授予角色的授权
- 从角色R收回对象O上的存取权P后，角色R就不再具有对象O上的存取权，这将影响所有具有角色R的用户或角色
- 例：
  - 使用如下语句可以收回角色Teller在关系Loan和Borrower上的所有存取权：
    `REVOK ALL PRIVILIGES ON Loan, Borrower FROM Teller；`
  - 在该语句执行后，所有具有角色Teller的用户（LiMing和ZhanHua）都不能再对关系Loan和Borrower进行任何操作，并且也同样影响角色Manager，导致具有Manager角色的经理WangWanli也不能再对关系Loan和Borrower进行任何操作
#### 收回角色
- REVOKE语句还可以从一个或多个用户或角色收回角色，但具有稍微不同的语法：  
```
REVOKE <角色列表> FROM <用户/角色列表>
{CASCADE|RESTRICT}
```
- 例:如果LiMing不再担任出纳，则可以用如下语句收回他的Toller角色：`REVOKE Teller FROM LiMing CASCADE;`
### 其他特性
- SQL标准指定了数据库模式的原始授权机制：只有模式属主才能对模式进行修改。因此，模式的修改（如关系的创建和删除，添加或去掉关系中的属性以及添加或去掉索引）只能由模式的属主来执行
- 一些数据库实现对数据库模式有更加强有力的授权机制，类似与前面讨论的那些机制，但这些机制并不是标准的
### SQL授权的局限
- SQL标准不提供元组级授权
- 基于Web的应用授权问题
## 强制存取控制
### 自主存取控制存在的问题
- 在自主存取控制中，系统根据用户对数据库对象的存取权限来进行安全控制，而不考虑数据库对象本身的安全等级
- 自主存取控制不能阻止副本的非授权传播
  - 例如，甲将自己权限内的数据存取权授予乙，本来只是允许乙本人操纵这些数据。但是，乙可以复制这些数据，制造副本,并在未征得甲同意的情况下传播副本
### 强制存取控制
- 强制存取控制（MAC）是系统为保证更高程度的安全性所采取的强制存取检查手段
- MAC是用户不能直接感知或进行控制的，适用于对数据有严格而固定密级分类的部门，如军事部门、政府部门等
### 主体与客体
在MAC中，DBMS所管理的全部实体被分为主体和客体两大类:  
- 主体是系统中的活动实体。主体可以是DBAS管理的实际用户、代表用户的各进程
- 客体是系统中的被动实体，是受主体操纵的，如文件、基本表、索引、视图等
### 敏感度标记
- 对于主体和客体，DBMS为它们的每个实例（值）指派一个敏感度标记（Label），敏感度标记分成若干级别
  - 绝密（Top Secret）、机密（Secret）、秘密（Confidential）、公开（Public)
- 主体的敏感度标记称为许可证级别（Clearance Level)
- 客体的敏感度标记称为密级（Classification Level)
- MAC机制就是通过对比主体和客体的敏感度标记，确定主体是否能够存取客体
### 强制存取控制规则
当一用户（或某一主体）注册进入系统时，系统要求他对任何客体的存取必须遵循下面两条规则：  
- (1)仅当主体的许可证级别大于或等于客体的密级时，该主体才能读取相应的客体
- (2)仅当主体的许可证级别等于客体的密级时，该主体才能写相应的客体
  - 某些系统修正了第2条规则：  
    (2)仅当主体的许可证级别小于或等于客体的密级时，该主体才能写相应的客体；即用户可以为写入的数据对象赋予高于自己的许可证级别的密级
### MAC与DAC
- MAC比DAC具有更高的保护级别。因此支持MAC的系统必须支持DAC，由DAC与MAC共同构成DBMS的安全机制
- 同时提供DAC和MAC保护的系统称为多级安全系统
- 在多级安全系统中，系统首先进行DAC检查，对通过DAC检查的允许存取的数据对象再由系统自动进行MAC检查，只有通过MAC检查的访问才是允许的
## 视图机制
### 基于视图的授权
- 视图是定义外模式，为用户提供个性化数据库模型的一种手段
- 视图可以隐蔽不希望用户看到的数据
  - 视图的这种隐藏数据的能力可以简化系统的使用
  - 可以与授权结合，限制用户只能访问所需要的数据，实现一定程度的安全保护
- 利用视图实现安全保护的基本思想是：
  - 首先通过定义视图，屏蔽掉一部分需要对某些用户保密的数据
  - 然后，在视图上定义存取权限，将对视图的访问权授予这些用户。而不允许他们直接访问定义视图的关系(基本表)
- 由于视图是用查询定义的，而查询是求满足某个谓词（查询条件）的元组集，因此视图与授权配合使用实际上间接实现了使用谓词定义用户的存取权限
- 需要说明的是
  - 创建视图的用户不一定能够获得该视图上的所有权限
  - 为了有效地阻止用户透过视图越权访问数据库，创建视图的用户在视图上所获得的权限不能超过他在定义视图的基本表上所拥有的权限
  - 例如，假设用户U对基本表T1拥有修改权（UPDATE），对基本表T2拥有读取数据权（SELECT），用户U基于基本表T1和T2创建了一个视图V，则用户U只能查询视图V
## 其他安全性手段
- 审计
  - 审计技术是一种监视措施，它跟踪数据库中的访问活动，监测可能的不合法行为
- 数据加密
  - 对高度敏感数据，还可以采用数据加密来保护数据的安全性
### 审计
审计启用一个专门的审计日志（Audit Log），自动记录所有用户对数据库的更新(插人、删除和修改)。审计日志记录如下信息:  
- 操作类型（插入、删除、修改）；
- 操作终端标识与操作者标识；
- 操作日期和时间；
- 操作涉及的数据（关系、元组、属性等）；
- 数据的前像（操作前的值）和后像（操作后的值）
:::tip
注意：审讲记录所有数据库更新，需要耗费大量的时间和空间。所以DBMS往往都将其作为可选特征，DBA可以根据具体应用的安全性要求，灵活地打开或关闭审计功能
:::
### 数据加密
- 数据加密的基本思想是按照一定的加密算法，将原始数据（明文）变换成不可直接识别的格式（密文）。使得不知道解密方法的人即使获得数据，也不知道数据的真实内容，从而达到保护数据的目的
- 合法用户使用数据时，可以容易使用解密算法还原数据
#### 加密算法
一个好的加密技术应该具有下面的性质:  
- 对授权用户来说，加密数据和解密数据相时简单；
- 加密模式不应依赖于算法的保密，而是依赖于算法参数，即依赖于密钥；
- 对入侵者来说，确定密钥是极其困难的
#### 数据加密
- 目前商品化DBMS产品都提供了数据加密例行程序，根据用户要求自动对存储和传输的数据进行加密处理。即使没有提供这种加密程序的DBMS，也都会提供加密接口，以方便用户使用其他厂商提供的加密程序对数据进行加密数据加密技术有很多
- 目前的许多商品化DRMS产品都提供了数据加密例行程序，可根据用户要求自动对存储和传输的数据进行加密处理
- 数据的加密和解密是比较费时的。并且占用大量的系统资源，因此一般只对高度机密的数据进行数据加密

## 本章测验
1【单选题】主体与客体属于（  ）  
A、主码约束  
B、外码约束  
C、域约束  
D、强制存取权限控制

2【单选题】下面不属于安全性控制手段的是（  ）  
A、用户标识与鉴别  
B、自主存取控制  
C、审计  
D、触发器

3【单选题】关于安全性，下面说法正确的是（  ）  
A、自主存取控制臂强制存取控制严格  
B、强制存取控制要求主体的许可证级别小于或等于客体的密级时，该主体才能写相应的客体  
C、角色是一个数据库用户  
D、审计技术是数据库管理系统必选的安全性措施

4【单选题】可以实现定义角色的SQL语句是（  ）  
A、CREATE ASSERTION  
B、CREATE TRIGGER  
C、CREATE ROLE  
D、CREATE DOMAIN